function validateEmail(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function selectDropDownItemByName(a,b){$(a+" option").filter(function(){return $(this).val()==b}).prop("selected",!0)}function addWaitingOverlay(a){if(0>=overlayCount){startStack=[];var b=document.createElement("div");b.setAttribute("id","overlay"),b.setAttribute("class","overlay"),document.body.appendChild(b),a||(busyTimer=setTimeout(function(){overlayCount>0&&(console.log("Overlay not ended appropriatly, forcing removeWaitingOverlay."),console.log("Start Calls: "+startStack),console.log("End Calls: "+endStack),overlayCount=1,removeWaitingOverlay())},18e4))}else startStack.push((new Error).stack);overlayCount++}function discountAmt(a,b){return Number(b-a/100*b).toFixed(2)}function removeWaitingOverlay(){if(overlayCount--,0>=overlayCount){try{document.body.removeChild(document.getElementById("overlay"))}catch(a){console.log(a)}clearTimeout(busyTimer),endStack=[]}else endStack.push((new Error).stack)}function getNewRandomNumber(a,b){return Math.round(Math.random()*(b-a)+a)}function getURLParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?null:decodeURIComponent(c[1].replace(/\+/g," "))}function getAsStr(a){var b=a;return"number"==typeof a?b=a+"":"string"!=typeof a&&(b=a.toString()),b}function isEmptyString(a){return"string"!=typeof a&&(a=getAsStr(a)),void 0==a||null==a?!1:!a||/^\s*$/.test(a)||0===a.length||!a.trim()||0===a.trim().length}function setFillColor(a,b){if(a.length>0&&b.length>0){var c=getColor(b[0]);null!=c&&("g"==a[0].nodeName?applyColorToGroupElement(a.children(),c):(a.attr("fill",c),a.css("fill",c)))}}function getColor(a){if("g"!=a.nodeName){var b=a.getAttribute("fill");if(null==b){var c=getStyleRules(a.getAttribute("style"));b=c.fill}return b}if("undefined"!=typeof a.children)for(var d=0;d<a.children.length;d++){var b=getColor(a.children[0]);if(b)return b}else for(var d=0;d<a.childNodes.length;d++)if(1==a.childNodes[d].nodeType){var b=getColor(a.childNodes[d]);if(b)return b}}function applyColorToGroupElement(a,b){a.each(function(a,c){"g"==c.nodeName?applyColorToGroupElement($(c).children(),b):($(c).attr("fill",b),$(c).css("fill",b))})}function getStyleRules(a){if(null==a)return{};for(var b={},c=a.split(";"),d=0;d<c.length;d++){var e=c[d].split(/:(.+)/);b[e[0]]=e[1]}return b}function editLogo(a,b){window.location="/logo-design-online?id="+a+(1==b?"&from=purchase":"")}function editCard(a,b){window.location="/design-business-card-online?id="+a+(1==b?"&from=purchase":"")}function addLogoToShoppingCart(a,b){"string"==typeof a&&0==a.indexOf("logo_")&&(a=a.split("_")[1]);var c={item_id:a,itemType:"LOGO"};if(1==isLoggedIn(!0))addWaitingOverlay(),doPost("/addItemToCurrentShoppingCart",c,function(a){removeWaitingOverlay(),200==a.status?void 0!=b&&b():bootbox.alert(a.msg)},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")});else{var d="cart_"+a;storeJson(d,c);var e=retrieveJson("carts");null!=e||void 0!=e?e.indexOf(d)<0&&(e.push(d),storeJson("carts",e)):storeJson("carts",[d]),void 0!=b&&b()}}function addCardToShoppingCart(a,b){"string"==typeof a&&0==a.indexOf("card_")&&(a=a.split("_")[1]);var c={item_id:a,itemType:"BC"};if(1==isLoggedIn(!0))addWaitingOverlay(),doPost("/addItemToCurrentShoppingCart",c,function(a){removeWaitingOverlay(),200==a.status?void 0!=b&&b():bootbox.alert(a.msg)},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")});else{var d="cart_"+a;storeJson(d,c);var e=retrieveJson("carts");null!=e||void 0!=e?e.indexOf(d)<0&&(e.push(d),storeJson("carts",e)):storeJson("carts",[d]),void 0!=b&&b()}}function addOtherProductToShoppingCart(a,b){var c={item_id:a,itemType:"OTHER"};addWaitingOverlay(),doPost("/addItemToCurrentShoppingCart",c,function(a){removeWaitingOverlay(),200==a.status?void 0!=b&&b():bootbox.alert(a.msg)},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")})}function saveItemLocally(a,b,c){storeJson(b,c);var d=retrieveJson(a);null!=d||void 0!=d?d.indexOf(b)<0&&(d.push(b),storeJson(a,d)):storeJson(a,[b])}function removeItemLocally(a,b){var c=retrieveJson(a);c.splice(c.indexOf(b),1),storeJson(a,c),deleteJson(b),removeItemLocallyFromShoppingCart(b)}function removeItemLocallyFromShoppingCart(a){var b=a.substr(a.indexOf("_")),c=retrieveJson("carts");if(deleteJson("cart"+b),null!=c||void 0!=c){var d=c.indexOf("cart"+b);d>=0&&(c.splice(d,1),storeJson("carts",c))}}function doPost(a,b,c,d){return doRequest(a,b,"POST",c,d,0)}function doGet(a,b,c,d){return doRequest(a,b,"GET",c,d,0)}function doGetWithExtraParams(a,b,c,d,e){return doRequest(a,b,"GET",function(a){d(a,c)},e,0)}function doRequest(a,b,c,d,e,f){return doActualRequest(a,b,c,d,e,f,!0)}function doSyncRequest(a,b,c){var d={};return doActualRequest(a,b,c,function(a){a.error?d.error=a:d=a},function(a){d.error=a},0,!1),d}function doActualRequest(a,b,c,d,e,f,g){var h=3,i=a,j={type:c,url:a};return void 0===f&&(f=0),window.actualSite&&(a=window.actualSite+a),"GET"==c?j.data=b:j.data=JSON.stringify(b),j.contentType="application/json",j.async=g,j.timeout=0,$.ajax(j).success(function(a){a.error?void 0!==e?e(a):showToast("Server returned error: "+a.error):d(a)}).fail(function(g,j,k){403==g.status?window.location=window.actualSite+"/?msg_id=1":4==Math.floor(g.status/100)?void 0!==e?e({error:g.status}):showToast("Server returned "+g.status+"."):h>f?(console.log("request failed. retrying...",new Error(a+" with "+JSON.stringify(b)).stack),console.log("XHR: ",g,"Status: ",j,"Error: ",k),void 0===e&&showToast("Request failed. Retrying..."),setTimeout(function(){doRequest(i,b,c,d,e,f+1)},3e3)):void 0!==e?e({error:"timeout"}):showToast("Communication Error")})}function showToast(a,b,c,d){void 0===d&&(d=3e3),void 0===b&&(b="danger");var e={duration:d,sticky:c,type:b};$.toast(a,e)}function isFunction(a){return a&&"function"==typeof a}function endsWith(a,b){return-1!==a.indexOf(b,a.length-b.length)}function storeJson(a,b){var c="store_"+a,d=JSON.stringify(b);void 0===localStorage?$.cookie(c,d,{expires:7,path:"/"}):localStorage.setItem(c,d)}function retrieveJson(a){var b,c="store_"+a;return b=void 0===localStorage?$.cookie(c):localStorage.getItem(c),void 0!==b&&""!=b||(b="{}"),JSON.parse(b)}function deleteJson(a){var b="store_"+a;void 0===localStorage?$.removeCookie(b,{path:"/"}):window.localStorage.removeItem(b)}function updateCardImage(a,b,c){var d=$(a);d.css({visibility:"hidden"}),d.svg();var e=d.svg("get");e.load(b,{onLoad:function(a,b){if($(a.root()).attr("height","100%"),$(a.root()).attr("width","100%"),b)console.log(b);else{var e=function(){d.css({visibility:"visible"})};if(c){var f=function(a){if(null!=a){var b,c,f=$("#logo",d);b="string"==typeof a?$(a):a;try{$("defs",b).remove(),c=$("#logo",d)[0].getBBox(),f.children().remove(),f.append(b),$(b).attr("height",c.height+"px"),$(b).attr("width",c.width+"px"),$(b).attr("x",c.x),$(b).attr("y",c.y),setFillColor($("#color1",d),$("#Color1",b)),setFillColor($("#color2",d),$("#Color2",b)),setFillColor($("#color3",d),$("#Color3",b))}catch(g){console.log(g)}e()}};if(0==c.indexOf("logo_"))f(retrieveJson(c).url);else if(0==c.trim().indexOf("<"))f(c);else{var g="/getUserLogoImage?id="+c+"&random="+(new Date).getTime();addWaitingOverlay(),logoCache[g]||(logoCache[g]=$.get(g+"&random="+Math.random())),logoCache[g].then(function(a){removeWaitingOverlay(),f($(a.childNodes).clone())},function(a,b,c){removeWaitingOverlay(),console.error(a,b,c)})}}else e()}},changeSize:!0})}function updateJQSvgImage(a,b,c){var d={onLoad:function(a,b){b?console.log(b):($(a.root()).attr("height","100%"),$(a.root()).attr("width","100%"),$("font",a.root()).remove(),$("style",a.root()).after($("#allFonts").html())),c?c():$.noop()},changeSize:!0};$(a).svg(),$(a).svg("get").load(b,d)}function updateMyDesignsCount(a){if(1==a){var b=0;doPost("/listUserLogos",{},function(a){200==a.status?b+=a.logos.length:201==a.status?console.log(a):console.log(a),$(".my-design-count").text(b)},function(a){showToast("Connection Error!"),console.log(a)}),doPost("/listUserCards",{},function(a){200==a.status?b+=a.cards.length:201==a.status?console.log(a):console.log(a),$(".my-design-count").text(b)},function(a){showToast("Connection Error!"),console.log(a)}),doGet("/listUserOtherProducts",{},function(a){200==a.status?b+=a.products.length:201==a.status?console.log(a):console.log(a),$(".my-design-count").text(b)},function(a){showToast("Connection Error!"),console.log(a)})}else{var c=retrieveJson("logos"),d=retrieveJson("cards"),e=0;null!=c&&(e+=c.length),null!=d&&(e+=d.length),$(".itemCount").text(e)}}function updateCartCount(a){1==a?doPost("/listCartItems",{},function(a){var b=0;200==a.status?b=a.items.length:201==a.status?b=0:console.log("Error: "+a.msg),$(".cart-order").text(b)},function(a){console.log(a)}):$(".cart-order").text(null==retrieveJson("carts")?0:retrieveJson("carts").length)}function downloadPurchasedItem(a,b){console.log("Edit Logossss")}function formatUrl(a,b){return encodeURIComponent(a?a.replace(/\s/g,"_"):b).toLowerCase()}function ieSVGFix(a){for(var b=1,c=0;1e3>b&&(-1==a.indexOf("xmlns:NS"+b)?c++:c=0,!(c>5));)a=a.replace("xmlns:NS"+b+'=""',""),a=a.replace("NS"+b+':xmlns:svg="http://www.w3.org/2000/svg"',""),a=a.replace("NS"+b+':xmlns:html="http://www.w3.org/1999/xhtml"',""),b++;return 1e3==b&&console.log("1000 iterations expired!!"),a}function getIframeWindow(a){var b;return a.contentWindow?a.contentWindow:a.window?a.window:(!b&&a.contentDocument&&(b=a.contentDocument),!b&&a.document&&(b=a.document),b&&b.defaultView?b.defaultView:b&&b.parentWindow?b.parentWindow:void 0)}var overlayCount=0,logoCache={},fxSetup,busyTimer,startStack=[],endStack=[];$(function(){$(".actualSite").each(function(a,b){$(b).attr("href",window.actualSite+$(b).attr("href"))}),void 0==window.actualSite&&(window.actualSite=window.location.origin)});var JSON=JSON||{};JSON.stringify=JSON.stringify||function(a){var b=typeof a;if("object"!=b||null===a)return"string"==b&&(a='"'+a+'"'),String(a);var c,d,e=[],f=a&&a.constructor==Array;for(c in a)a.hasOwnProperty(c)&&(d=a[c],b=typeof d,"string"==b?d='"'+d+'"':"object"==b&&null!==d&&(d=JSON.stringify(d)),e.push((f?"":'"'+c+'":')+String(d)));return(f?"[":"{")+String(e)+(f?"]":"}")},JSON.parse=JSON.parse||function(str){return""===str&&(str='""'),eval("var p="+str+";"),p},$.fn.exists=function(){return 0!==this.length};